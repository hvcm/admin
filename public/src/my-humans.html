<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iris-polymer-table/iris-table.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-humans">
		<template>
				<style include="shared-styles">
						:host {
								display: block;
								padding: 10px;
						}
						iris-table {
								max-height: 80vh;
						}

				</style>
				<paper-input label="Поиск" value="{{searchString}}"></paper-input>
				<iris-table id="humansTable" fields-model="[[fieldsModel]]" data="[[filter(app.list,searchString)]]" on-cell-tap="cellTap"></iris-table>
		</template>

		<script>
				Polymer({
						is: 'my-humans',
						properties: {
								app: {
										type: Object,
										notify: true
								}
						},
						inFields(fields, searchString) {},
						permissionsToString(value, key) {
								// console.log(key, value);
								switch (key) {
										case 1:

												break;
										default:
												return 'x';
								}
						},
						filter(data, searchString) {
								if (!searchString)
										return data;

								return _.filter(data, item => this.inFields([
										'last_name', 'first_name', 'middle_name'
								], searchString));
						},
						ready: function () {
								const transform = value => value || '-';
								this.fieldsModel = [
										{
												field: '@type',
												label: 'Имя',
												transform
										}, {
												field: 'last_name',
												label: 'Имя',
												transform
										}, {
												field: 'middle_name',
												label: 'Отчество',
												transform
										}, {
												field: 'login',
												label: 'Логин'
										}, {
												field: 'permissions',
												label: 'Права',
												transform: permissions => _.map(permissions, this.permissionsToString)
										}
								];

						}
				});
		</script>
</dom-module>
